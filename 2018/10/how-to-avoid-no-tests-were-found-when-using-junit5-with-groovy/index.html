<!DOCTYPE html><html lang="en"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="author" content="Szymon Stepniak"><title>How to avoid &quot;No tests were found&quot; when using JUnit 5 with Groovy?</title><meta name="description" content="In this short blog post I would like to explain how to avoid popular mistake when you write your first JUnit 5 test case in Groovy.The exampleLet&amp;#8217;s start with the example. Here is our build.gradle file that adds JUnit 5 dependency:Listing 1. buil..."><link rel="alternate" type="application/rss+xml" title="e.printStackTrace(); // Blog" href="/atom.xml"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="stylesheet" href="//cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css"><link rel="stylesheet" href="//cdn.bootcss.com/highlight.js/9.6.0/styles/androidstudio.min.css"><link rel="stylesheet" href="/css/main.css?v=18"><link rel="stylesheet" href="/css/conum.css"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Noto+Serif:400,700,400italic"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Droid+Sans+Mono:400,700"><meta name="description" content="In this short blog post I would like to explain how to avoid popular mistake when you write your first JUnit 5 test case in Groovy."><meta name="keywords" content="groovy,unit-test,junit,junit5,gradle,ide"><meta property="og:type" content="article"><meta property="og:title" content="How to avoid &quot;No tests were found&quot; when using JUnit 5 with Groovy?"><meta property="og:url" content="https://e.printstacktrace.blog/2018/10/how-to-avoid-no-tests-were-found-when-using-junit5-with-groovy/index.html"><meta property="og:site_name" content="e.printStackTrace(); &#x2F;&#x2F; Blog"><meta property="og:description" content="In this short blog post I would like to explain how to avoid popular mistake when you write your first JUnit 5 test case in Groovy."><meta property="og:locale" content="en"><meta property="og:image" content="https://e.printstacktrace.blog/images/og/groovy-junit5.jpg"><meta property="og:updated_time" content="2018-10-24T07:00:48.000Z"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="How to avoid &quot;No tests were found&quot; when using JUnit 5 with Groovy?"><meta name="twitter:description" content="In this short blog post I would like to explain how to avoid popular mistake when you write your first JUnit 5 test case in Groovy."><meta name="twitter:image" content="https://e.printstacktrace.blog/images/og/groovy-junit5.jpg"><meta name="twitter:creator" content="@wololock"></head><body><nav class="navbar navbar-default navbar-fixed-top navbar-custom"><div class="container-fluid"><div class="navbar-header"><button type="button" data-toggle="collapse" data-target="#main-navbar" class="navbar-toggle"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="/" class="navbar-brand"><span>e.printStackTrace(); // Blog</span></a></div><div id="main-navbar" class="collapse navbar-collapse"><ul class="nav navbar-nav navbar-right"><li><a href="/archives">Archive</a></li><li><a href="https://github.com/wololock/wololock.github.io">Github</a></li><li><a href="https://travis-ci.org/wololock/wololock.github.io"><img src="https://travis-ci.org/wololock/wololock.github.io.png?branch=develop"></a></li></ul></div></div></nav><header class="header-section"><div style="background-image:url(/img/groovy-junit5-bg.jpg)" class="intro-header"><div class="container"><div class="row"><div class="col-lg-10 col-lg-offset-1 col-md-10 col-md-offset-1"><div class="post-heading"><a href="/categories/How-to/" class="category">How to</a><h1>How to avoid &quot;No tests were found&quot; when using JUnit 5 with Groovy?</h1><div class="post-meta"><ul><li><time datetime="2018-10-24T07:00:48.000Z" itemprop="datePublished">Oct 24, 2018</time></li><li>2 minutes read</li><li><a href="https://e.printstacktrace.blog/2018/10/how-to-avoid-no-tests-were-found-when-using-junit5-with-groovy/#disqus_thread">0 Comments</a></li></ul></div></div></div></div></div></div></header><div class="container"><div class="row"><div class="col-lg-10 col-lg-offset-1 col-md-10 col-md-offset-1"><article role="main" class="blog-post"><div class="paragraph"><p>In this short blog post I would like to explain how to avoid popular mistake when you write your first JUnit 5 test case in Groovy.</p></div><a id="more"></a><div class="sect1"><h2 id="the-example">The example</h2><div class="sectionbody"><div class="paragraph"><p>Let&#8217;s start with the example. Here is our <code>build.gradle</code> file that adds JUnit 5 dependency:</p></div><div class="listingblock"><div class="title">Listing 1. build.gradle</div><div class="content"><pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">plugins {
    id 'groovy'
    id 'idea'
}

repositories {
	jcenter()
}

dependencies {
    compile localGroovy()

    testImplementation 'org.junit.jupiter:junit-jupiter-api:5.3.1'
    testRuntimeOnly 'org.junit.jupiter:junit-jupiter-engine:5.3.1'
}

test {
    useJUnitPlatform()
}</code></pre></div></div><div class="paragraph"><p>And here is our test class:</p></div><div class="listingblock"><div class="title">Listing 2. src/test/groovy/UnitTest.groovy</div><div class="content"><pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import org.junit.jupiter.api.Test

class UnitTest {

    @Test
    def shouldThrowAnException() {
        throw new RuntimeException()
    }
}</code></pre></div></div><div class="paragraph"><p>This test does nothing, but it&#8217;s fine. We just want to execute this test.</p></div></div></div><div class="sect1"><h2 id="the-problem">The problem</h2><div class="sectionbody"><div class="paragraph"><p>Let&#8217;s see what happens when we try to run this test:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">% gradle test

BUILD SUCCESSFUL in 1s
2 actionable tasks: 2 executed</code></pre></div></div><div class="paragraph"><p>Nothing happened. When we try to execute this test inside IntelliJ IDEA, we will see something like this:</p></div><div class="imageblock img-responsive img-thumbnail"><div class="content"><a class="image" href="/images/groovy-junit5-def-mistake.png"><img src="/images/groovy-junit5-def-mistake.png" alt="groovy junit5 def mistake"></a></div></div><div class="paragraph"><p>What&#8217;s wrong?</p></div></div></div><div class="sect1"><h2 id="the-solution">The solution</h2><div class="sectionbody"><div class="paragraph"><p>The problem we shown above is caused by a single <code>def</code> keyword we used in <code>shouldThrowAnException</code> prototype. This is common mistake, made very often by people who have experience with Spock Framework (which tolerates <code>def</code> btw).</p></div><div class="paragraph"><p>So, what is the problem with <code>def</code> keyword? Firstly, let&#8217;s take a look at the decompiled class:</p></div><div class="listingblock"><div class="title">Listing 3. Decompiled UnitTest.class file</div><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">//
// Source code recreated from a .class file by IntelliJ IDEA
// (powered by Fernflower decompiler)
//

import groovy.lang.GroovyObject;
import groovy.lang.MetaClass;
import org.codehaus.groovy.runtime.callsite.CallSite;
import org.junit.jupiter.api.Test;

public class UnitTest implements GroovyObject {
    public UnitTest() {
        CallSite[] var1 = $getCallSiteArray();
        super();
        MetaClass var2 = this.$getStaticMetaClass();
        this.metaClass = var2;
    }

    @Test
    public Object shouldThrowAnException() {
        CallSite[] var1 = $getCallSiteArray();
        throw (Throwable)var1[0].callConstructor(RuntimeException.class);
    }
}</code></pre></div></div><div class="paragraph"><p>As you can see Groovy&#8217;s <code>def</code> keyword gets compiled to <code>Object</code> type in this case. OK, but what is wrong with that? Well, JUnit 5 method resolver <a href="https://github.com/junit-team/junit5/blob/master/junit-jupiter-engine/src/main/java/org/junit/jupiter/engine/discovery/predicates/IsTestMethod.java" target="_blank" rel="noopener">uses <code>IsTestMethod</code> predicate</a> which requires that test method returns <code>void</code>. Otherwise method annotated with <code>@Test</code> does not get resolved.</p></div><div class="paragraph"><p>If we only replace <code>def</code> with <code>void</code> keyword:</p></div><div class="listingblock"><div class="title">Listing 4. Updated src/test/groovy/UnitTest.groovy</div><div class="content"><pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import org.junit.jupiter.api.Test

class UnitTest {

    @Test
    void shouldThrowAnException() {
        throw new RuntimeException()
    }
}</code></pre></div></div><div class="paragraph"><p>the test will execute and fail as expected:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">% gradle test

&gt; Task :test FAILED

UnitTest &gt; shouldThrowAnException() FAILED
    java.lang.RuntimeException at UnitTest.groovy:7

1 test completed, 1 failed

FAILURE: Build failed with an exception.

* What went wrong:
Execution failed for task ':test'.
&gt; There were failing tests. See the report at: file:///home/wololock/workspace/groovy-junit5/build/reports/tests/test/index.html

* Try:
Run with --stacktrace option to get the stack trace. Run with --info or --debug option to get more log output. Run with --scan to get full insights.

* Get more help at https://help.gradle.org

BUILD FAILED in 1s
2 actionable tasks: 2 executed</code></pre></div></div></div></div><section class="post-tags"><a href="/tags/groovy/" class="tag post-meta">#groovy</a><a href="/tags/unit-test/" class="tag post-meta">#unit-test</a><a href="/tags/junit/" class="tag post-meta">#junit</a><a href="/tags/junit5/" class="tag post-meta">#junit5</a><a href="/tags/gradle/" class="tag post-meta">#gradle</a><a href="/tags/ide/" class="tag post-meta">#ide</a></section><footer class="post-footer"><img src="https://www.gravatar.com/avatar/b22c1842c6e8f7f2b9b3ed8c0d4efb4d?s=200" class="img-responsive img-circle"><div class="row author"><div class="col-lg-8 col-lg-offset-2 col-xs-10 col-xs-offset-1"><h4>Szymon Stepniak</h4><p>Groovista, Upwork's Top Rated freelancer, Toruń Java User Group founder, open&nbsp;source contributor, Stack Overflow addict, bedroom guitar player. I walk through e.printStackTrace() so you don't have to.</p><ul class="social-links"><li><a href="https://github.com/wololock" onclick="return window.open(this.href),!1"><span class="fa fa-github"></span></a></li><li><a href="https://stackoverflow.com/users/2194470/szymon-stepniak?tab=profile" onclick="return window.open(this.href),!1"><span class="fa fa-stack-overflow"></span></a></li><li><a href="https://twitter.com/wololock" onclick="return window.open(this.href),!1"><span class="fa fa-twitter"></span></a></li><li><a href="mailto:szymon.stepniak@gmail.com" onclick="return window.open(this.href),!1"><span class="fa fa-envelope"></span></a></li><li><a href="https://www.linkedin.com/in/szymon-stępniak-9a0b1630" onclick="return window.open(this.href),!1"><span class="fa fa-linkedin"></span></a></li></ul></div></div></footer><section class="related-posts"><h2>You may also like</h2><div class="row"><div class="col-lg-4"><a href="/2018/06/ratpack-mocking-Session-object-in-GroovyRequestFixture-test/"><img src="/images/og/ratpack-mocking-session.jpg" class="img-responsive"><h3>Ratpack: mocking Session object in GroovyRequestFixture test</h3></a><p>Ratpack allows you unit test handlers using GroovyRequestFixture class. The good thing about this approach is that it does not require running the whole application and you can quickly test if the ...</p></div><div class="col-lg-4"><a href="/2018/06/ratpack-register-session-module-in-handler-unit-test/"><img src="/images/og/ratpack-session-module.jpg" class="img-responsive"><h3>Ratpack: register SessionModule in handler unit test</h3></a><p>Unit testing Ratpack handlers has many benefits. In the previous post we have learned how to mock Session object to use it with GroovyRequestFixture. Today instead of mocking we will register Sessi...</p></div><div class="col-lg-4"><a href="/2018/07/how-to-name-groovy-script-file/"><img src="/images/og/groovy-script-how-to-name.jpg" class="img-responsive"><h3>How to name Groovy script file?</h3></a><p>Some time ago I have found a very interesting question on Stack Overflow about forbidden characters in Groovy script filenames. Let&#8217;s use it as an excuse to make a closer look at Groovy scrip...</p></div></div></section></article><nav role="pagination" class="pagination"><a href="/2018/10/micronaut-non-blocking-and-async-part1/" class="pull-left btn">← Next post</a><a href="/2018/10/graalvm-and-groovy-how-to-start/" class="pull-right btn">Previous post →</a></nav><div class="disqus-comments"><div class="comments"><div id="disqus_thread"></div></div></div><script>var url_parts=window.location.href.split("?"),disqus_url=url_parts[0];!function(){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src="//eprintstacktrace.disqus.com/embed.js",(document.head||d.body).appendChild(t)}()</script></div></div></div><script id="dsq-count-scr" src="//eprintstacktrace.disqus.com/count.js"></script><footer class="site-footer"><div class="inner"><section class="copyright">This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/80x15.png"></a></section><section class="poweredby"><ul><li><span>Published with </span><a href="https://hexo.io">Hexo</a></li><li><span>Hosted on </span><a href="https://github.com/wololock/wololock.github.io"><span class="fa fa-github"></span></a></li><li><span>Deployed with </span><a href="https://travis-ci.org/wololock/wololock.github.io">Travis CI</a></li><li><span>Subscribe </span><a href="http://feeds.feedburner.com/Eprintstacktracenet"><span class="fa fa-rss"></span></a></li></ul></section></div></footer><script src="//cdn.bootcss.com/jquery/1.11.2/jquery.min.js"></script><script src="//cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/js/main.js?v=5"></script><script src="/js/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad()</script><script>"localhost"!==window.location.hostname&&"127.0.0.1"!==window.location.hostname&&(!function(a,e,n,o,t,c,g){a.GoogleAnalyticsObject=t,a.ga=a.ga||function(){(a.ga.q=a.ga.q||[]).push(arguments)},a.ga.l=1*new Date,c=e.createElement(n),g=e.getElementsByTagName(n)[0],c.async=1,c.src="//www.google-analytics.com/analytics.js",g.parentNode.insertBefore(c,g)}(window,document,"script",0,"ga"),ga("create","UA-42400890-5","auto"),ga("send","pageview"))</script></body></html>