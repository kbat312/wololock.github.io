<!DOCTYPE html><html lang="en"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="author" content="Szymon Stepniak"><title>Ratpack: mocking Session object in GroovyRequestFixture test</title><meta name="description" content="Ratpack allows you unit test handlers using GroovyRequestFixture class. The good thing about this approach is that it does not require running the whole application and you can quickly test if the handler does what you expect. However, if you retrieve ..."><link rel="alternate" type="application/rss+xml" title="e.printStackTrace(); // Blog" href="/atom.xml"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="stylesheet" href="//cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css"><link rel="stylesheet" href="//cdn.bootcss.com/highlight.js/9.13.1/styles/androidstudio.min.css"><link rel="stylesheet" href="/css/main.css?v=18"><link rel="stylesheet" href="/css/conum.css"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Noto+Serif:400,700,400italic"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Droid+Sans+Mono:400,700"><meta name="description" content="Ratpack allows you unit test handlers using GroovyRequestFixture class. The good thing about this approach is that it does not require running the whole application and you can quickly test if the han"><meta name="keywords" content="groovy,ratpack,spock,unit-test,session,mock"><meta property="og:type" content="article"><meta property="og:title" content="Ratpack: mocking Session object in GroovyRequestFixture test"><meta property="og:url" content="https://e.printstacktrace.blog/2018/06/ratpack-mocking-Session-object-in-GroovyRequestFixture-test/index.html"><meta property="og:site_name" content="e.printStackTrace(); &#x2F;&#x2F; Blog"><meta property="og:description" content="Ratpack allows you unit test handlers using GroovyRequestFixture class. The good thing about this approach is that it does not require running the whole application and you can quickly test if the han"><meta property="og:locale" content="en"><meta property="og:image" content="https://e.printstacktrace.blog/images/og/ratpack-mocking-session.jpg"><meta property="og:updated_time" content="2018-06-24T09:59:57.000Z"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="Ratpack: mocking Session object in GroovyRequestFixture test"><meta name="twitter:description" content="Ratpack allows you unit test handlers using GroovyRequestFixture class. The good thing about this approach is that it does not require running the whole application and you can quickly test if the han"><meta name="twitter:image" content="https://e.printstacktrace.blog/images/og/ratpack-mocking-session.jpg"><meta name="twitter:creator" content="@wololock"></head><body><nav class="navbar navbar-default navbar-fixed-top navbar-custom"><div class="container-fluid"><div class="navbar-header"><button type="button" data-toggle="collapse" data-target="#main-navbar" class="navbar-toggle"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="/" class="navbar-brand"><span>e.printStackTrace(); // Blog</span></a></div><div id="main-navbar" class="collapse navbar-collapse"><ul class="nav navbar-nav navbar-right"><li><a href="/archives">Archive</a></li><li><a href="https://github.com/wololock/wololock.github.io">Github</a></li><li><a href="https://travis-ci.org/wololock/wololock.github.io"><img src="https://travis-ci.org/wololock/wololock.github.io.png?branch=develop"></a></li></ul></div></div></nav><header class="header-section"><div style="background-image:url(/images/ratpack-cookbook-bg.jpg)" class="intro-header"><div class="container"><div class="row"><div class="col-lg-10 col-lg-offset-1 col-md-10 col-md-offset-1"><div class="post-heading"><a href="/categories/Ratpack-Cookbook/" class="category">Ratpack Cookbook</a><h1>Ratpack: mocking Session object in GroovyRequestFixture test</h1><div class="post-meta"><ul><li><time datetime="2018-06-24T09:59:57.000Z" itemprop="datePublished">Jun 24, 2018</time></li><li>2 minutes read</li><li><a href="https://e.printstacktrace.blog/2018/06/ratpack-mocking-Session-object-in-GroovyRequestFixture-test/#disqus_thread">0 Comments</a></li></ul></div></div></div></div></div></div></header><div class="container"><div class="row"><div class="col-lg-10 col-lg-offset-1 col-md-10 col-md-offset-1"><article role="main" class="blog-post"><div class="paragraph"><p><a href="https://ratpack.io" target="_blank" rel="noopener">Ratpack</a> allows you unit test handlers using <a href="https://ratpack.io/manual/1.5.4/api/ratpack/groovy/test/handling/GroovyRequestFixture.html" target="_blank" rel="noopener"><code>GroovyRequestFixture</code></a> class. The good thing about this approach is that it does not require running the whole application and you can quickly test if the handler does what you expect. However, if you retrieve objects from Raptack&#8217;s registry you will run into a problem - registry in this case is empty.</p></div><a id="more"></a><div class="paragraph"><p>In some cases you may find mocking <code>Session</code> object useful. Especially if you only want to retrieve specific object or value from session and do something with it. <code>GroovyRequestFixture.handle(chain, closure)</code> gives you an access to <code>registry</code> through the closure passed in the second parameter.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">GroovyRequestFixture.handle(yourHandler) {
    registry { r -&gt;
        r.add(Session, mockSession)
    }
}</code></pre></div></div><div class="paragraph"><p>Here we have registered <code>mockSession</code> to be injected anytime <code>Session</code> instance is being retrieved from the registry. Keep in mind that mock object does nothing by default (e.g. it return <code>null</code> values for methods invocation) so you will have to "configure" your mock object to return something significant. For instance:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">Session mockSession = Mock(Session) {
    get('test') &gt;&gt; Promise.value(Optional.of('Lorem ipsum'))
}</code></pre></div></div><div class="paragraph"><p>will return <code>Lorem ipsum</code> value (as a promise of optional) for <code>session.get('test')</code>.</p></div><div class="paragraph"><p>And here you can find a full example:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import groovy.transform.CompileStatic
import ratpack.exec.Promise
import ratpack.groovy.handling.GroovyChainAction
import ratpack.groovy.test.handling.GroovyRequestFixture
import ratpack.http.Status
import ratpack.jackson.internal.DefaultJsonRender
import ratpack.session.Session
import spock.lang.Specification

import static ratpack.jackson.Jackson.json

class MockSessionSpec extends Specification {

    final Session session = Mock(Session) {
        get('test') &gt;&gt; Promise.value(Optional.of('Lorem ipsum'))
    }

    final GroovyChainAction chainAction = new GroovyChainAction() {
        @Override
        @CompileStatic
        void execute() throws Exception {
            get('foo') {
                get(Session).get('test').map { Optional&lt;String&gt; o -&gt;
                    o.orElse(null)
                }.flatMap { value -&gt;
                    Promise.value(value)
                }.then {
                    render(json([message: it]))
                }
            }
        }
    }

    def "should retrieve message from Session object"() {
        given:
        def result = GroovyRequestFixture.handle(chainAction) {
            uri 'foo'
            method 'GET'
            registry { r -&gt;
                r.add(Session, session)
            }
        }

        expect:
        result.status == Status.OK

        and:
        result.rendered(DefaultJsonRender).object == [message: 'Lorem ipsum']
    }
}</code></pre></div></div><section class="post-tags"><a href="/tags/groovy/" class="tag post-meta">#groovy</a><a href="/tags/ratpack/" class="tag post-meta">#ratpack</a><a href="/tags/spock/" class="tag post-meta">#spock</a><a href="/tags/unit-test/" class="tag post-meta">#unit-test</a><a href="/tags/session/" class="tag post-meta">#session</a><a href="/tags/mock/" class="tag post-meta">#mock</a></section><footer class="post-footer"><img src="https://www.gravatar.com/avatar/b22c1842c6e8f7f2b9b3ed8c0d4efb4d?s=200" class="img-responsive img-circle"><div class="row author"><div class="col-lg-8 col-lg-offset-2 col-xs-10 col-xs-offset-1"><h4>Szymon Stepniak</h4><p>Groovista, Upwork's Top Rated freelancer, Toruń Java User Group founder, open&nbsp;source contributor, Stack Overflow addict, bedroom guitar player. I walk through e.printStackTrace() so you don't have to.</p><ul class="social-links"><li><a href="https://github.com/wololock" onclick="return window.open(this.href),!1"><span class="fa fa-github"></span></a></li><li><a href="https://stackoverflow.com/users/2194470/szymon-stepniak?tab=profile" onclick="return window.open(this.href),!1"><span class="fa fa-stack-overflow"></span></a></li><li><a href="https://twitter.com/wololock" onclick="return window.open(this.href),!1"><span class="fa fa-twitter"></span></a></li><li><a href="mailto:szymon.stepniak@gmail.com" onclick="return window.open(this.href),!1"><span class="fa fa-envelope"></span></a></li><li><a href="https://www.linkedin.com/in/szymon-stępniak-9a0b1630" onclick="return window.open(this.href),!1"><span class="fa fa-linkedin"></span></a></li></ul></div></div></footer><section class="related-posts"><h2>You may also like</h2><div class="row"><div class="col-lg-4"><a href="/2018/06/ratpack-register-session-module-in-handler-unit-test/"><img src="/images/og/ratpack-session-module.jpg" class="img-responsive"><h3>Ratpack: register SessionModule in handler unit test</h3></a><p>Unit testing Ratpack handlers has many benefits. In the previous post we have learned how to mock Session object to use it with GroovyRequestFixture. Today instead of mocking we will register Sessi...</p></div><div class="col-lg-4"><a href="/2018/10/how-to-avoid-no-tests-were-found-when-using-junit5-with-groovy/"><img src="/images/og/groovy-junit5.jpg" class="img-responsive"><h3>How to avoid "No tests were found" when using JUnit 5 with Groovy?</h3></a><p>In this short blog post I would like to explain how to avoid popular mistake when you write your first JUnit 5 test case in Groovy.</p></div><div class="col-lg-4"><a href="/2018/09/groovy-dynamic-types-coercion-and-promotion-you-have-been-warned/"><img src="/images/og/groovy-dynamic-types.jpg" class="img-responsive"><h3>Groovy: dynamic types coercion and promotion - you have been warned!</h3></a><p>Groovy is a very powerful language on a JVM platform and with this great power comes great responsibility. There are many language features that are not intuitive for many people that start using G...</p></div></div></section></article><nav role="pagination" class="pagination"><a href="/2018/06/ratpack-register-session-module-in-handler-unit-test/" class="pull-left btn">← Next post</a><a href="/2018/05/count-frequency-of-a-digit-in-a-factorial-of-number-using-Haskell/" class="pull-right btn">Previous post →</a></nav><div class="disqus-comments"><div class="comments"><div id="disqus_thread"></div></div></div><script>var url_parts=window.location.href.split("?"),disqus_url=url_parts[0];!function(){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src="//eprintstacktrace.disqus.com/embed.js",(document.head||d.body).appendChild(t)}()</script></div></div></div><script id="dsq-count-scr" src="//eprintstacktrace.disqus.com/count.js"></script><footer class="site-footer"><div class="inner"><section class="copyright">This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/80x15.png"></a></section><section class="poweredby"><ul><li><span>Published with </span><a href="https://hexo.io">Hexo</a></li><li><span>Hosted on </span><a href="https://github.com/wololock/wololock.github.io"><span class="fa fa-github"></span></a></li><li><span>Deployed with </span><a href="https://travis-ci.org/wololock/wololock.github.io">Travis CI</a></li><li><span>Subscribe </span><a href="http://feeds.feedburner.com/Eprintstacktracenet"><span class="fa fa-rss"></span></a></li></ul></section></div></footer><script src="//cdn.bootcss.com/jquery/1.11.2/jquery.min.js"></script><script src="//cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/js/main.js?v=5"></script><script src="/js/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad()</script><script>"localhost"!==window.location.hostname&&"127.0.0.1"!==window.location.hostname&&(!function(a,e,n,o,t,c,g){a.GoogleAnalyticsObject=t,a.ga=a.ga||function(){(a.ga.q=a.ga.q||[]).push(arguments)},a.ga.l=1*new Date,c=e.createElement(n),g=e.getElementsByTagName(n)[0],c.async=1,c.src="//www.google-analytics.com/analytics.js",g.parentNode.insertBefore(c,g)}(window,document,"script",0,"ga"),ga("create","UA-42400890-5","auto"),ga("send","pageview"))</script></body></html>